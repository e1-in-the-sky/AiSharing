<ion-header>
  <ion-toolbar color="header" text-center>
    <!-- <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons> -->
    
    <!-- <ion-buttons slot="start">
      <ion-button (click)="dismissModal()">
        <ion-icon name="arrow-round-back"></ion-icon>
      </ion-button>
    </ion-buttons> -->
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons> 
    

    <ion-title>相乗り投稿</ion-title>
    
    <!-- <ion-buttons slot="end">
      <ion-button (click)="dismissModal()">Close</ion-button>
    </ion-buttons> -->
  
  </ion-toolbar>
</ion-header>

<ion-content padding>
  <form>
    <ion-list>
      <ion-item>
        <ion-label position="floating">
          出発時刻
        </ion-label>
        <!-- <ion-label position="floating" color="danger">*出発時刻を入力してください</ion-label> -->
        <!-- <ion-input type="text" [(ngModel)]="data.departure_time" name="departure_time" required></ion-input> -->
        <ion-datetime displayFormat="YYYY-MM-DD HH:mm" pickerFormat="YYYY-MM-DD HH:mm" [(ngModel)]="data.departure_time"
          name="departure_time" (ngModelChange)="on_date_changed()" [min]="min_date" [max]="max_date"></ion-datetime>
      </ion-item>

      <ion-item>
        <ion-label position="floating">
          <!-- <img src="../../../assets/img/place_start.png" style="height: 32px; width: 20px;"> -->
          出発地
        </ion-label>
        <ion-input type="text" [(ngModel)]="data.departure_name" (ngModelChange)="inputDeparture($event)" name="departure_name" required></ion-input>
      </ion-item>

      <ng-container *ngIf="isLoadingDeparuteLocalInfo">
        <ion-progress-bar type="indeterminate"></ion-progress-bar>
      </ng-container>
      
      <!-- 出発地を選ぶためのセレクトボックス -->
      <!-- {{departureLocalInfo.Feature?.length}} -->
      <ng-container *ngIf="departureLocalInfo?.Feature; else nonDepartureLocalInfo">
        <!-- サンプル -->
        <!-- <ng-container *ngFor="let localInfo of departureLocalInfo?.Feature; index as i;">
          <p>{{i+1}}: {{localInfo.Name}}</p>
        </ng-container> -->

        <!-- セレクトボックス -->
        <ion-select [(ngModel)]="indexOfSelectedDepatureLocation" name="indexOfSelectedDepatureLocation" (ngModelChange)="selectDepartureLocation()">
          <ion-select-option *ngFor="let localInfo of departureLocalInfo?.Feature; index as i;" [value]="i" [selected]="i === 0">
            {{i+1}}: {{localInfo.Name}}
          </ion-select-option>
        </ion-select>
        <!-- <p>indexOfSelectedDepatureLocation: {{indexOfSelectedDepatureLocation}}</p> -->
        <p style="font-size: 14px; color: grey; padding-left: 16px; margin: 4px 0;">
          <img src="../../../assets/img/icon_post.jpg" style="height: 14px; width: 14px;"> {{selectedDepartureAddress}}
        </p>
        <!-- <img class="location-img" [src]="departureLocationMapImageUrl" *ngIf="departureLocationMapImageUrl !== ''"> -->
      </ng-container>

      <!-- もし候補地が空なら"表示する候補地がありません"と表示する -->
      <ng-template #nonDepartureLocalInfo>
        <p style="padding-left: 16px; font-size: 13px;">表示する候補地がありません</p>
        <!-- <ion-select>
          <ion-select-option [selected]=true>
            表示する候補地がありません
          </ion-select-option>
        </ion-select> -->
      </ng-template>

      <ion-item>
        <ion-label position="floating">目的地</ion-label>
        <ion-input type="text" [(ngModel)]="data.destination_name" (ngModelChange)="inputDestination($event)" name="destination_name" required></ion-input>
      </ion-item>

      <ng-container *ngIf="isLoadingDestinationLocalInfo">
        <ion-progress-bar type="indeterminate"></ion-progress-bar>
      </ng-container>

      <!-- 目的地を選ぶためのセレクトボックス -->
      <!-- {{destinationLocalInfo.Feature?.length}} -->
      <ng-container *ngIf="destinationLocalInfo?.Feature; else nonDestinationLocalInfo">
        <!-- サンプル -->
        <!-- <ng-container *ngFor="let localInfo of destinationLocalInfo?.Feature; index as i;">
          <p>{{i+1}}: {{localInfo.Name}}</p>
        </ng-container> -->

        <!-- セレクトボックス -->
        <ion-select [(ngModel)]="indexOfSelectedDestinationLocation" name="indexOfSelectedDestinationLocation" (ngModelChange)="selectDestinationLocation()">
          <ion-select-option *ngFor="let localInfo of destinationLocalInfo?.Feature; index as i;" [value]="i" [selected]="i === 0">
            {{i+1}}: {{localInfo.Name}}
          </ion-select-option>
        </ion-select>
        <!-- <p>indexOfSelectedDestinationLocation: {{indexOfSelectedDestinationLocation}}</p> -->
        <p style="font-size: 14px; color: grey; padding-left: 16px; margin: 4px 0;">
          <img src="../../../assets/img/icon_post.jpg" style="height: 14px; width: 14px;"> {{selectedDestinationAddress}}
        </p>
        <!-- <img class="location-img" [src]="destinationLocationMapImageUrl" *ngIf="destinationLocationMapImageUrl !== ''"> -->
      </ng-container>

      <!-- もし候補地が空なら"表示する候補地がありません"と表示する -->
      <ng-template #nonDestinationLocalInfo>
        <p style="padding-left: 16px; font-size: 13px;">表示する候補地がありません</p>
        <!-- <ion-select>
          <ion-select-option [selected]=true>
            表示する候補地がありません
          </ion-select-option>
        </ion-select> -->
      </ng-template>

      <div id="course_map" style="width: 100%; max-width: 400px; height:200px; margin: auto; border-radius: 10px;"></div>

      <p *ngIf="totalDistance" style="margin: 8px 0;">距離: {{totalDistance / 1000 | number:'1.0-1'}}km</p>
      <p *ngIf="totalTime" style="margin: 8px 0;">時間: {{totalTime / 60 | number:'1.0-0'}}分</p>
      <p *ngIf="fare" style="margin: 8px 0 0 0;">参考料金: {{fare | number:'1.0-0'}}円</p>
      <p *ngIf="fare" style="margin: 0 0 8px 0; font-size: 12px;">({{data.max_passenger_count}}人の場合1人あたリ{{fare / data.max_passenger_count | number: '1.0-0'}}円)</p>
  
      <!-- 経路画像のURLが存在する場合表示する -->
      <!-- <ng-container *ngIf="courseMapImageUrl !== ''">
        <p>経路サンプル: (出発地と目的地が20km以上離れている場合、経路は表示されません)</p>
        <img class="course-img" [src]="courseMapImageUrl">
      </ng-container> -->

      
      <p>最大乗車人数</p>
      <ion-item>
        <img src="../../../assets/img/minus.png" style="height:40px; width:40px;"(click)="on_click_max_passenger(-1)">
        <h3>{{data.max_passenger_count}}</h3>
        <img src="../../../assets/img/plus.png" style="height:40px; width:40px;" (click)="on_click_max_passenger(1)">
      </ion-item>
      <p>現在乗車人数</p>
      <ion-item>
        <img src="../../../assets/img/minus.png" style="height:40px; width:40px;"(click)="on_click_passenger(-1)">
        <h3>{{data.passenger_count}}</h3>
        <img src="../../../assets/img/plus.png" style="height:40px; width:40px;"(click)="on_click_passenger(1)">
      </ion-item>
      <ion-item>
        <ion-checkbox (click)="data.onlywoman = !data.onlywoman"></ion-checkbox>
         <div style="padding-left: 4px;">女性限定</div>
      </ion-item>
      <ion-item>
        <ion-checkbox (click)="data.bigluggage = !data.bigluggage"></ion-checkbox>        
         <div style="padding-left: 4px;">大きい荷物あり</div>
      </ion-item>
      
      <ion-item>
        <ion-label position="floating" >コメント</ion-label>
        <ion-input type="text" [(ngModel)]="data.comment" name="comment" maxlength="30"></ion-input>
      </ion-item>
    </ion-list>
    
    <!-- Yahoo API Map -->
    <!-- <div id="yahoomap" style="width:300px; height:200px"></div> -->

    <p>
      <ion-button expand="block" color="primary" type="button" (click)="onPost()">投稿</ion-button>
    </p>
  </form>
</ion-content>